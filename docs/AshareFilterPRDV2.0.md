# 高精度行业龙头反转策略 - PRD V2.0

## 概述

本文档描述了**高精度行业龙头反转策略 V2.0**的完整技术规格和实现方案。该策略在 V1.0 基础上，基于 PRD v0.2 建议进行了深度优化，实现了**数据精准性**和**策略逻辑**的全面升维。

---

## 一、核心优化点 (PRD v0.2 落地)

### 1.1 数据精准性提升

| 优化项 | V1.0 实现 | V2.0 优化 | 效果 |
|--------|-----------|-----------|------|
| **财务数据** | 简单净利润 > 0 | TTM + 扣非净利润 + ROE | 剔除伪业绩、季节性波动干扰 |
| **价格数据** | 原始收盘价 | 前复权价格 | KDJ/均线等指标计算准确 |
| **行业定义** | 申万二级行业 | RPS 行业强度筛选 | 选出真正强势行业 |
| **筹码分布** | 简单涨幅计算 | VWAP + 换手率衰减 + 单峰判定 | 真实反映持仓成本 |

### 1.2 策略逻辑升维

| 优化项 | V1.0 实现 | V2.0 优化 | 效果 |
|--------|-----------|-----------|------|
| **热门定义** | 行业股票数量 | RPS 强度前 20% | 选出真热点 |
| **买点精度** | KDJ 金叉 | KDJ 金叉 + 支撑位共振 + 底背离 | 减少假信号 |
| **资金验证** | 无 | 北向资金连续净买入 | 跟随聪明钱 |

---

## 二、股票池 (Universe)

### 2.1 基础筛选

| 条件 | 阈值 | 说明 |
|------|------|------|
| 排除 ST/*ST | - | 剔除高风险股票 |
| 上市时间 | > 60 天 | 剔除次新股 |
| 交易状态 | 正常上市 | 剔除停牌 |

### 2.2 行业筛选

| 条件 | 阈值 | 说明 |
|------|------|------|
| RPS 行业强度 | 前 20% | 计算申万行业指数 20 日涨幅 |
| 行业趋势 | 站上 20 日均线 | 确保行业处于多头趋势 |

### 2.3 龙头筛选

| 条件 | 阈值 | 说明 |
|------|------|------|
| 总市值 | ≥ 100 亿 | 确保流动性和机构参与 |
| 扣非净利润(TTM) | > 0 | 主业盈利 |
| ROE(TTM) | > 5% | 股东回报合格 |

---

## 三、核心因子 (Factors)

### 3.1 筹码面因子

| 因子名称 | 精准定义 | 阈值 | 说明 |
|----------|----------|------|------|
| **相对获利盘** | VWAP + 换手率衰减算法 | < 15% | 使用均价计算持仓成本 |
| **筹码集中度** | (90%成本上限-下限)/现价 | < 20% | 筹码越集中越好 |
| **单峰密集** | 峰值在现价下方 15% 内 | 是 | 主力吸筹完成 |

### 3.2 技术面因子

| 因子名称 | 精准定义 | 阈值 | 说明 |
|----------|----------|------|------|
| **均线乖离率** | (现价-MA60)/MA60 | -15% ~ 5% | 回踩生命线附近 |
| **KDJ 日线** | K 上穿 D | 金叉 | 短期买点 |
| **KDJ 周线** | J < 50 | 未过热 | 中期趋势健康 |
| **MACD 底背离** | 股价新低但 MACD 柱未新低 | 是 | 强烈买入信号 |
| **布林下轨支撑** | 接近 BB_LOWER | 5% 以内 | 技术支撑位 |

### 3.3 量价配合因子

| 因子名称 | 精准定义 | 阈值 | 说明 |
|----------|----------|------|------|
| **量比** | 当日成交量/20日均量 | 0.8 ~ 3.0 | 温和放量，拒绝爆量 |

### 3.4 资金面因子 (加分项)

| 因子名称 | 精准定义 | 条件 | 说明 |
|----------|----------|------|------|
| **北向资金** | 连续 5 天净买入 | 是 | 外资抄底信号 |
| **主力资金** | 5 日净流入 | > 0 | 国内主力关注 |

---

## 四、交易信号 (Signal)

### 4.1 买入信号

满足以下**全部**条件：

1. ✅ 股票池通过（ST/市值/财务）
2. ✅ 行业 RPS 强度前 20%
3. ✅ 获利比例 < 15%
4. ✅ 乖离率在 -15% ~ 5% 区间
5. ✅ KDJ 日线金叉
6. ✅ 量比在 0.8 ~ 3.0

**加分项** (满足任一即大幅提升评分)：
- ⭐ MACD 底背离
- ⭐ 北向资金连续净买入
- ⭐ 主力资金净流入
- ⭐ 单峰密集形态

### 4.2 止损策略

| 条件 | 动作 |
|------|------|
| 收盘价跌破成本价 - 7% | 无条件止损 |

### 4.3 止盈策略

| 条件 | 动作 |
|------|------|
| 日线 KDJ 死叉 | 部分止盈 |
| 股价跌破 MA10 | 全部止盈 |

---

## 五、代码结构

### 5.1 模块划分

```python
# 模块1: 数据清洗层
def step1_clean_data()       # 剔除ST/停牌/新股
def get_financial_ttm()      # TTM财务数据
def get_roe_ttm()            # ROE(TTM)
def get_market_cap()         # 市值获取

# 模块2: 行业层
def step2_select_industry()  # RPS行业筛选
def get_industry_trend()     # 行业趋势判断

# 模块3: 筹码层
def step3_calc_chips_precision()  # VWAP筹码计算
    # - VWAP 均价
    # - 换手率衰减
    # - 单峰密集判定

# 模块4: 技术层
def get_daily_data_adjusted()     # 前复权日线
def get_weekly_data_adjusted()    # 前复权周线
def calculate_kdj()                # KDJ计算
def calculate_macd()               # MACD计算
def calculate_ma()                 # 均线计算
def calculate_bollinger_bands()   # 布林带计算
def step4_technical_scan()         # 技术扫描
    # - 乖离率
    # - KDJ金叉
    # - 支撑位
    # - 底背离

# 模块5: 资金验证
def get_northbound_funds()   # 北向资金
def get_main_funds()         # 主力资金

# 模块6: 信号与报告
def evaluate_buy_signal()    # 买入信号评估
def generate_report_v2()     # 报告生成
```

### 5.2 配置参数

```python
CONFIG = {
    # 股票池
    'MIN_MARKET_CAP': 100e8,      # 市值门槛
    'MIN_LISTED_DAYS': 60,        # 上市时间
    
    # 财务
    'MIN_ROE_TTM': 5.0,           # ROE门槛
    'MIN_NET_PROFIT_TTM': 0,      # 扣非净利润
    
    # 行业
    'RPS_THRESHOLD': 85,          # RPS阈值
    'RPS_DAYS': 20,               # RPS周期
    
    # 筹码
    'MAX_PROFIT_RATIO': 15.0,     # 获利比例
    'MAX_CHIP_CONCENTRATION': 20.0, # 集中度
    
    # 技术
    'MA_BIAS_MIN': -15.0,         # 乖离率下限
    'MA_BIAS_MAX': 5.0,           # 乖离率上限
    'WEEKLY_KDJ_THRESHOLD': 50,  # 周线J值
    
    # 量价
    'VOLUME_RATIO_MIN': 0.8,      # 量比下限
    'VOLUME_RATIO_MAX': 3.0,      # 量比上限
    
    # 风控
    'STOP_LOSS_PCT': 7.0,         # 止损线
    
    # 资金
    'NORTHBORD_DAYS': 5,          # 北向连续天数
}
```

---

## 六、评分系统

### 6.1 综合评分 (满分 100)

| 条件 | 得分 |
|------|------|
| 获利盘 < 10% | +20 |
| KDJ 金叉 | +20 |
| 北向资金连续净买入 | +20 |
| 主力资金净流入 | +15 |
| MACD 底背离 | +15 |
| 单峰密集形态 | +10 |

### 6.2 评级

| 评分 | 评级 | 建议 |
|------|------|------|
| 80-100 | ⭐⭐⭐ 强力买入 | 重点关注 |
| 60-79 | ⭐⭐ 建议买入 | 正常关注 |
| 40-59 | ⭐ 观望 | 谨慎参与 |
| < 40 | - | 不建议 |

---

## 七、风控措施

### 7.1 仓位管理

- 单只股票仓位：≤ 20%
- 总持仓数量：5-8 只
- 单日总仓位：≤ 80%

### 7.2 止损纪律

- 买入后收盘价跌破 **成本价 - 7%**，无条件止损
- 盘中跌破 **成本价 - 5%**，可考虑提前止损

### 7.3 止盈纪律

- 日线 KDJ 死叉，减仓 50%
- 股价跌破 MA10，全部止盈
- 累计涨幅 > 30%，逐步止盈

---

## 八、输出报告

### 8.1 Markdown 报告

包含内容：
1. 策略说明与优化点
2. 入选行业列表
3. 多阈值筛选结果
4. 候选股票详细分析
5. 风控说明

### 8.2 CSV 数据

包含字段：
- 代码、名称、行业
- 现价、市值
- 营收TTM、扣非净利润TTM、ROE
- 获利盘、乖离率、KDJ
- 量比、北向资金、主力资金
- 综合评分

---

## 九、版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| V1.0 | 2026-02-17 | 初始版本 |
| V2.0 | 2026-02-17 | PRD v0.2 优化版 |

---

## 十、注意事项

1. **数据延迟**：财务数据有滞后性，实际使用需注意季报发布时间
2. **API 限制**：Tushare 有调用频率限制，大规模筛选需考虑缓存
3. **流动性风险**：高市值股票可能在极端行情下流动性不足
4. **模型风险**：历史数据不代表未来表现

---

*文档版本: V2.0*
*生成时间: 2026-02-17*
