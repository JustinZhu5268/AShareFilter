这是一个非常专业的进阶要求。从“能跑通”到“能实战”，核心就在于**数据的颗粒度（Granularity）**、**清洗的精准度（Precision）**以及**逻辑的鲁棒性（Robustness）**。

针对你现有的策略，我从**数据源清洗、因子精度、逻辑闭环**三个维度进行了深度拆解和优化。

---

### 🚀 维度一：数据精准性的深度提升 (Data Precision)

你之前的策略在数据处理上比较粗糙，实战中容易出现“伪信号”。以下是必须做的**4点数据清洗升级**：

#### 1. 财务数据的“时效性”修正
*   **原逻辑**：`营收 Top 5` + `净利润 > 0`。
*   **问题**：年报/季报有滞后性。现在的“营收Top5”可能是半年前的数据。且“净利润>0”包含了很多微利、甚至靠变卖资产盈利的垃圾股。
*   **优化方案**：
    *   使用 **TTM (Trailing Twelve Months)** 数据：滚动计算过去4个季度的总和，而非只看上一期年报。
    *   增加 **扣非净利润 (Deducted NP)**：剔除政府补贴和卖房收益，确保主业是赚钱的。
    *   **ROE 门槛**：要求 `ROE(TTM) > 8%`。龙头不仅要大，还要强。

#### 2. 价格数据的“复权”处理
*   **原逻辑**：直接读取行情接口。
*   **问题**：A股分红送转频繁。如果不做**前复权 (Forward Adjusted)** 处理，KDJ 指标会在除权日出现断崖式下跌（假死叉），筹码分布也会完全计算错误。
*   **优化方案**：所有技术指标（KDJ、MA）和筹码计算，**必须**基于`前复权`价格计算。

#### 3. 行业定义的“颗粒度”
*   **原逻辑**：申万二级行业。
*   **问题**：二级行业有时太宽泛。例如“半导体”里，做“设备”的和做“设计”的周期完全不同。
*   **优化方案**：
    *   优先使用 **申万三级行业**（如果数据源支持）。
    *   或者引入 **RPS (Relative Price Strength) 股价相对强度**：计算该行业指数相对于沪深300的超额收益，只选 RPS > 85（强于市场85%）的行业。

#### 4. 筹码分布的“算法”升级
*   **原逻辑**：简单的换手率衰减。
*   **问题**：未考虑**“涨停板/跌停板”**时的筹码锁定（缩量无法交换筹码），也未考虑**“均价交易”**的误差。
*   **优化方案**：
    *   引入 **VWAP (成交量加权平均价)** 代替收盘价进行筹码堆积。
    *   增加 **“单峰密集”** 判定：如果获利盘 < 10%，但上方筹码非常分散（多峰），说明套牢盘压力巨大，反弹很难；如果上方筹码形成单峰（主力吸筹完成），爆发力才强。

---

### 🚀 维度二：策略逻辑的升维 (Logic Optimization)

为了解决“热门行业”与“超跌”的逻辑悖论，我们需要引入**“趋势+结构”**的双重确认。

#### 1. 修正“热门”定义：从“涨幅”改为“趋势”
*   **旧逻辑**：近半年涨幅/成交额 Top 10。
*   **新逻辑**：
    *   **行业趋势**：行业指数站上 20日均线（处于多头趋势中）。
    *   **个股地位**：个股必须是该行业的**核心资产**（总市值 > 100亿 或 机构持仓比例 > 5%）。

#### 2. 修正“买点”精度：引入“结构”
*   **旧逻辑**：KDJ 金叉（容易钝化，跌势中可以金叉再死叉）。
*   **新逻辑**：**KDJ 金叉 + 关键支撑位共振**。
    *   **支撑位**：股价回踩到 **60日均线 (生命线)** 或 **布林带下轨 (Bollinger Lower Band)** 附近企稳。
    *   **背离**：股价创新低，但 MACD 绿柱缩短（底背离）。

#### 3. 增加“聪明钱”验证
*   **新因子**：**北向资金 (Northbound Funds)**。
    *   逻辑：在股价下跌过程中，如果北向资金连续 3-5 天逆势净买入，说明外资在抄底，胜率大幅提升。

---

### 📄 最终版 PRD：高精度行业龙头反转策略

基于上述优化，这是为你重新设计的、可直接用于编写专业代码的 PRD。

#### 1. 股票池 (Universe)
*   **范围**：全 A 股（剔除 ST、上市 < 60天、停牌）。
*   **行业筛选**：
    *   数据源：申万二级/三级行业。
    *   **RPS 筛选**：计算行业指数近 20 日涨幅，取排名前 20% 的行业（确保是真热点）。
*   **龙头锁定**：
    *   **市值门槛**：总市值 ≥ 100亿（确保流动性，机构票）。
    *   **基本面**：`扣非净利润(TTM) > 0` **且** `ROE(TTM) > 5%`。

#### 2. 核心因子 (Factors)

| 维度 | 因子名称 | 精准定义 (Python逻辑) | 阈值/条件 |
| :--- | :--- | :--- | :--- |
| **筹码面** | **相对获利盘** | 使用 VWAP + 历史衰减算法计算 | **获利比例 < 15%** (放宽一点，避免漏掉强势股) |
| **筹码面** | **筹码集中度** | (90%成本上限 - 90%成本下限) / 现价 | **< 20%** (可选，表示筹码没乱) |
| **技术面** | **均线乖离** | (现价 - MA60) / MA60 | **-15% < 乖离率 < 5%** (回踩生命线附近) |
| **技术面** | **KDJ 共振** | 周线 J < 50 (未过热) + 日线金叉 | **日线 K 上穿 D** |
| **资金面** | **量价配合** | 量比 (Volume Ratio) | **> 0.8 且 < 3.0** (温和放量，拒绝爆量出货) |
| **验证项** | **北向/主力** | 5日主力资金流向 | **净流入 > 0** (可选，加分项) |

#### 3. 交易信号 (Signal)
*   **买入**：满足上述所有因子。
*   **止损 (风控)**：买入后收盘价跌破 **成本价 - 7%**，无条件止损。
*   **止盈**：日线 KDJ 死叉 **或** 股价跌破 MA10。

---

### 💻 优化后的代码结构建议 (Python + Tushare)

为了实现“高精度”，代码结构需要调整为：

```python
# 伪代码结构预览

def step1_clean_data():
    """
    数据清洗层：
    1. 获取全市场数据，剔除ST、停牌。
    2. 获取复权因子，计算前复权价格。
    3. 计算 TTM 财务数据，剔除伪龙头。
    """
    pass

def step2_select_industry():
    """
    行业层：
    1. 计算申万行业指数的 RPS (相对强度)。
    2. 选出 RPS > 85 的强势行业。
    """
    pass

def step3_calc_chips_precision(df_daily):
    """
    高精度筹码层：
    1. 使用 VWAP (均价) 而非 Close。
    2. 引入 '换手率衰减' 算法。
    3. 返回：获利比例、筹码集中度。
    """
    pass

def step4_technical_scan(df_daily):
    """
    技术层：
    1. 计算 MA60 乖离率 (判断是否回踩到位)。
    2. 计算 KDJ (基于复权价)。
    3. 判定 MACD 底背离 (高级加分项)。
    """
    pass

def main():
    # 串联执行，输出 Excel 报告
    # 报告中必须包含：行业、代码、现价、获利盘、距MA60乖离、量比
    pass
```

### 💡 总结
这次优化的核心在于**“去伪存真”**：
1.  用 **TTM** 去掉伪业绩。
2.  用 **复权价** 去掉伪技术指标。
3.  用 **RPS** 去掉伪热点。
4.  用 **VWAP筹码** 去掉伪获利盘。

如果你准备好了，我可以基于 **Tushare Pro** (假设你已经搞定 Token) 为你编写这份**高精度**的代码。是否开始？